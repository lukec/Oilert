#!/usr/bin/env perl
use 5.12.0;
use YAML q/LoadFile/;
use lib 'lib';
use Oilert::Notifier;
use FindBin;
use Dancer ':syntax';
use Cwd qw/realpath/;

Dancer::Config::setting('appdir',realpath("$FindBin::Bin/.."));
config->{environment} = 'production' if -d '/home/dotcloud';
Dancer::Config::load();

my $data = LoadFile("$FindBin::Bin/../data/ships.yaml") or die "Couldn't load the Yaml!";
my $notifier = Oilert::Notifier->new;

my $notifications = $notifier->check($data);
for my $n (@$notifications) {
    $notifier->notify($n);
}

exit;

