#!/usr/bin/env perl
use strict;
use warnings;
use URI;
use Web::Scraper;

my $ships = scraper {
    process "table tr", "ships[]" => scraper {
        process "td:nth-child(2)", 'name' => 'TEXT';
        process "td:nth-child(2) a", 'detail_url' => '@href';
        process "td:nth-child(3)", 'type' => 'TEXT';
        process "td:nth-child(4)", 'speed' => 'TEXT';
        process "td:nth-child(11) a", 'map_url' => '@href';
    };
    result 'ships';
};

my $uri = 'http://www.marinetraffic.com/ais/datasheet.aspx?SHIPNAME=&TYPE_SUMMARY=Cargo&PORT_ID=682&menuid=&datasource=SHIPS_CURRENT&app=&mode=&B1=Search';
my $foo = $ships->scrape(URI->new($uri));
use Data::Dumper;
warn Dumper $foo;
